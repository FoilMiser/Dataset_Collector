schema_version: "0.8"
updated_utc: "2026-06-10T00:00:00Z"

companion_files:
  license_map: ./license_map.yaml
  field_schemas: ./field_schemas.yaml
  denylist: ./denylist.yaml

globals:
  raw_root: /data/earth/raw
  screened_yellow_root: /data/earth/screened_yellow
  combined_root: /data/earth/combined
  ledger_root: /data/earth/_ledger
  pitches_root: /data/earth/_pitches
  manifests_root: /data/earth/_manifests
  queues_root: /data/earth/_queues
  catalogs_root: /data/earth/_catalogs
  logs_root: /data/earth/_logs
  require_yellow_signoff: true

  sharding:
    max_records_per_shard: 50000
    compression: gzip

  screening:
    min_chars: 200
    max_chars: 12000
    text_field_candidates:
      - text
      - content
      - body
      - description
      - abstract
    record_license_field_candidates:
      - license
      - license_spdx
      - rights
      - usage_rights
    require_record_license: false
    allow_spdx:
      - CC-BY-4.0
      - CC0-1.0
      - MIT
      - Apache-2.0
      - CC-BY-SA-4.0
      - US-PUBLIC-DOMAIN
      - OGL-UK-3.0
    deny_phrases:
      - noai
      - "no tdm"
      - "no machine learning"
      - "all rights reserved"

  default_gates:
    - snapshot_terms
    - resolve_license_spdx
    - restriction_phrase_scan
    - emit_training_manifest
    - emit_attribution_bundle

queues:
  emit:
    - id: green_download
      path: /data/earth/_queues/green_download.jsonl
      criteria:
        effective_bucket: GREEN
        enabled: true
    - id: yellow_pipeline
      path: /data/earth/_queues/yellow_pipeline.jsonl
      criteria:
        effective_bucket: YELLOW
        enabled: true
    - id: red_rejected
      path: /data/earth/_queues/red_rejected.jsonl
      criteria:
        effective_bucket: RED
        enabled: true

gates_catalog:
  snapshot_terms: Save Terms/ToS + license page HTML/PDF + retrieval timestamp.
  resolve_license_spdx: Normalize license to SPDX via license_map.yaml rules; store evidence.
  restriction_phrase_scan: Scan terms/content for restriction phrases (no-LLM/no-TDM/etc.).
  record_level_filter: Require per-record license metadata; keep only allowlist.
  extract_text_chunks: Extract text into JSONL chunks using globals.text_processing_defaults unless overridden.
  emit_training_manifest: Manifest of included files/records + checksums + license evidence.
  emit_attribution_bundle: Generate ATTRIBUTION.md + CITATIONS.bib for included sources.
  manual_legal_review: Human review required before training.
  segregate_copyleft_pool: Force output into copyleft pool and keep isolated.
  near_duplicate_detection: Run MinHash/LSH deduplication pass.
  split_aware_partition: Partition data respecting split_group_id for leak prevention.

resolvers:
  http:
    mode: direct_url
    note: Direct file download with resume support.
  ftp:
    mode: base_url + globs
    note: List + filter by glob; store directory listing snapshot.
  git:
    mode: repo
    note: Capture commit hash; store LICENSE + README as evidence.
  zenodo:
    mode: record_id_or_doi
    api: https://zenodo.org/api/records/{record_id}
    outputs:
      - files[*].links.self
      - files[*].checksum
    verify_checksum: true
    checksum_algorithm: md5
  dataverse:
    mode: persistent_id
    default_instance: https://dataverse.harvard.edu
    note: Capture license from Dataverse metadata.
  huggingface_datasets:
    mode: dataset_id
    note: Use datasets.load_dataset; capture dataset card + license field.
  stac_catalog:
    mode: catalog_url
    note: Metadata-only STAC summaries (Earth-specific).
  thredds_opendap:
    mode: dataset_url
    note: Metadata-only variable dictionary retrieval from THREDDS/OPeNDAP endpoints.
  api_tabular:
    mode: base_url
    note: Tabular indicator APIs (CSV/JSON) with schema capture.

targets:

  - id: synthetic_earth_cards
    name: "Synthetic Earth dataset cards (deterministic; schema-validated)"
    enabled: false
    priority: 1
    license_profile: permissive
    license_evidence: { spdx_hint: CC0-1.0, url: "" }
    download:
      strategy: none
    build:
      owner: you
      output_formats: [jsonl]
      required_fields:
        - dataset_id
        - title
        - description
        - license_spdx
        - provider
        - geo_extent
      field_schema_version: earth_dataset_card_v1.0.0
    routing:
      subject: earth
      domain: env_policy_reports
      category: dataset_docs
      level: 3
      granularity: target
    output:
      pool: permissive

  - id: usgs_publications
    name: "USGS publications and program fact sheets"
    enabled: true
    priority: 2
    license_profile: permissive
    license_evidence:
      spdx_hint: US-PUBLIC-DOMAIN
      url: https://www.usgs.gov/information-policies-and-instructions/copyrights-and-credits
    download:
      strategy: http
      url: https://prd-wret.s3.us-west-2.amazonaws.com/assets/palladium/production/atoms/files/usgs-copyrights-and-credits.pdf
      filename: usgs_copyrights_and_credits.pdf
    routing:
      subject: earth
      domain: geology_geophysics
      category: reports
      level: 4
      granularity: file
    output:
      pool: permissive

  - id: noaa_ncei_docs
    name: "NOAA NCEI data use guides and documentation"
    enabled: true
    priority: 3
    license_profile: permissive
    license_evidence:
      spdx_hint: US-PUBLIC-DOMAIN
      url: https://www.noaa.gov/information-technology/policies
    download:
      strategy: http
      url: https://www.ncei.noaa.gov/access/services/search/v1/download?dataset=global-hourly&format=json
      filename: ncei_global_hourly_metadata.json
    routing:
      subject: earth
      domain: climate
      category: dataset_docs
      level: 5
      granularity: file
    output:
      pool: permissive

  - id: copernicus_cmems_metadata
    name: "Copernicus Marine (CMEMS) catalog metadata snapshots"
    enabled: false
    priority: 4
    license_profile: record_level
    license_evidence:
      spdx_hint: COPERNICUS-SENTINEL-LEGAL-NOTICE
      url: https://marine.copernicus.eu/terms-and-conditions
    download:
      strategy: api_tabular
      base_url: https://catalogue.marine.copernicus.eu/catalog/catalog.xml
      notes: "Metadata-only; requires screening to JSONL canonical shape."
    routing:
      subject: earth
      domain: remote_sensing
      category: stac_metadata
      level: 6
      granularity: record
    yellow_screen:
      text_field_candidates: [abstract, description, summary, text]
      record_license_field_candidates: [license, rights, licence]
    output:
      pool: quarantine
