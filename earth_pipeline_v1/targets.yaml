# targets_earth.yaml
# Environmental / Earth Systems specialization targets
# Generated: 2025-12-17
# Pipeline intent: ingest ONLY ethically + legally reusable sources (green),
# route mixed/conditional sources through license screening (yellow),
# and explicitly block sources that are incompatible (red).

version: "0.1"
domain: "environmental_earth_systems"
language: "en"

defaults:
  chunking:
    max_chars: 12000
    overlap_chars: 800
  output:
    dataset_id_prefix: "earth"
  licensing:
    policy_file: "licenses_earth.yaml"
  storage:
    # Prefer storing raw binaries (pdf/netcdf/etc.) separately from text chunks.
    raw_store: "raw/"
    text_store: "text/"
    structured_store: "structured/"

# -----------------------------------------------------------------------------
# TARGETS
# Each target is a "collection rule" describing:
# - where to pull from (seed_urls or api endpoints)
# - which worker to use
# - the expected licensing tier (green/yellow/red)
# - how to discover + filter documents
# -----------------------------------------------------------------------------
targets:

  # ---------------------------------------------------------------------------
  # GREEN: public domain or clearly open with minimal restrictions (still log license)
  # ---------------------------------------------------------------------------

  - id: "commonpile_env_earth_en"
    tier: "green"
    worker: "commonpile_filter_worker"
    input:
      dataset: "commonpile"
      version: "v0.1"
    filters:
      language: ["en"]
      # Prefer only examples with explicit open/public-domain licenses.
      license_allowlist:
        - "US-PD"
        - "CC0-1.0"
        - "CC-BY-4.0"
        - "CC-BY-3.0"
        - "OGL-UK-3.0"
        - "OGL-Canada-2.0"
        - "CC-BY-2.0"
      topic_keywords_any:
        - "climate"
        - "weather"
        - "hydrology"
        - "water quality"
        - "air quality"
        - "ecosystem"
        - "biodiversity"
        - "geology"
        - "earthquake"
        - "volcano"
        - "wildfire"
        - "drought"
        - "flood"
        - "land use"
        - "soil"
        - "remote sensing"
        - "satellite"
        - "reanalysis"
        - "ocean"
        - "cryosphere"
        - "carbon cycle"
        - "emissions"
      # Optional: keep a small fraction of non-matching docs for general language balance
      keep_background_ratio: 0.05
    outputs:
      jsonl: "text/commonpile_env_earth_en.jsonl"

  - id: "usgs_publications"
    tier: "green"
    worker: "web_pdf_html_worker"
    discovery:
      seed_urls:
        - "https://pubs.usgs.gov/"
        - "https://www.usgs.gov/publications"
        - "https://www.usgs.gov/programs"
      allow_domains: ["usgs.gov"]
      include_url_regex:
        - "(?i)pubs\.usgs\.gov"
        - "(?i)/publications"
        - "(?i)\.pdf$"
      exclude_url_regex:
        - "(?i)/multimedia/"
        - "(?i)youtube\.com"
    licensing:
      expected: "US-PD"
      notes: "USGS content is generally public domain; exclude items marked as third‑party copyrighted."
    topic_tags: ["geology", "hydrology", "hazards", "maps"]
    outputs:
      jsonl: "text/usgs_publications.jsonl"

  - id: "usgs_water_services_metadata"
    tier: "green"
    worker: "api_tabular_worker"
    discovery:
      seed_urls:
        - "https://waterdata.usgs.gov/"
        - "https://waterservices.usgs.gov/"
      allow_domains: ["usgs.gov"]
    extraction:
      mode: "metadata_plus_schema"
      # Prefer dataset descriptions, parameter definitions, station metadata.
      include_sections:
        - "parameter_codes"
        - "site_metadata"
        - "service_docs"
    licensing:
      expected: "US-PD"
    outputs:
      jsonl: "structured/usgs_waterservices_cards.jsonl"

  - id: "noaa_ncei_docs_and_guides"
    tier: "green"
    worker: "web_pdf_html_worker"
    discovery:
      seed_urls:
        - "https://www.ncei.noaa.gov/"
      allow_domains: ["noaa.gov"]
      include_url_regex:
        - "(?i)ncei\.noaa\.gov"
        - "(?i)documentation"
        - "(?i)\.pdf$"
      exclude_url_regex:
        - "(?i)youtube\.com"
        - "(?i)third[-_ ]party"
    licensing:
      expected: "US-PD"
      notes: "NOAA-created media is generally uncopyrighted; treat items with explicit copyright notices as exceptions."
    topic_tags: ["climate", "ocean", "weather", "reanalysis", "extremes"]
    outputs:
      jsonl: "text/noaa_ncei_docs.jsonl"

  - id: "nws_public_products_glossaries"
    tier: "green"
    worker: "web_html_worker"
    discovery:
      seed_urls:
        - "https://www.weather.gov/"
      allow_domains: ["weather.gov"]
      include_url_regex:
        - "(?i)/glossary"
        - "(?i)/safety"
        - "(?i)/about"
        - "(?i)/disclaimer"
      exclude_url_regex:
        - "(?i)radar"
        - "(?i)image"
        - "(?i)map"
    licensing:
      expected: "US-PD"
      notes: "Prefer text-only educational/definition pages; skip large image tiles."
    topic_tags: ["weather", "hazards", "forecasting"]
    outputs:
      jsonl: "text/nws_glossaries.jsonl"

  - id: "nasa_earthdata_docs_and_policies"
    tier: "green"
    worker: "web_pdf_html_worker"
    discovery:
      seed_urls:
        - "https://www.earthdata.nasa.gov/"
      allow_domains: ["earthdata.nasa.gov", "nasa.gov"]
      include_url_regex:
        - "(?i)/data-use"
        - "(?i)/data-rights"
        - "(?i)/open-data"
        - "(?i)\.pdf$"
      exclude_url_regex:
        - "(?i)/images"
        - "(?i)/multimedia"
    licensing:
      expected: "US-PD"
      notes: "NASA generally permits reuse; treat any third‑party copyrighted elements as exclusions."
    topic_tags: ["remote_sensing", "data_products", "metadata", "atbd"]
    outputs:
      jsonl: "text/nasa_earthdata_docs.jsonl"

  - id: "nasa_daac_data_use_guides_cards"
    tier: "green"
    worker: "web_pdf_worker"
    discovery:
      seed_urls:
        - "https://modaps.modaps.eosdis.nasa.gov/"
      allow_domains: ["eosdis.nasa.gov", "modaps.eosdis.nasa.gov", "modaps.modaps.eosdis.nasa.gov"]
      include_url_regex:
        - "(?i)data[-_ ]use"
        - "(?i)citation"
        - "(?i)\.pdf$"
    extraction:
      mode: "dataset_card_from_pdf"
    licensing:
      expected: "US-PD"
      notes: "Prefer DAAC data-use/citation PDFs; they are high-signal for variable and product descriptions."
    topic_tags: ["remote_sensing", "modis", "viirs", "atmosphere"]
    outputs:
      jsonl: "text/nasa_daac_guides.jsonl"

  - id: "epa_open_data_and_docs"
    tier: "green"
    worker: "web_pdf_html_worker"
    discovery:
      seed_urls:
        - "https://www.epa.gov/data"
        - "https://www.epa.gov/environmental-topics"
        - "https://edg.epa.gov/"
      allow_domains: ["epa.gov"]
      include_url_regex:
        - "(?i)/data"
        - "(?i)/open-data"
        - "(?i)license"
        - "(?i)\.pdf$"
      exclude_url_regex:
        - "(?i)/multimedia"
        - "(?i)youtube\.com"
    licensing:
      expected: "US-PD"
      notes: "EPA-produced data is public domain unless otherwise specified."
    topic_tags: ["air_quality", "water_quality", "toxics", "compliance", "emissions"]
    outputs:
      jsonl: "text/epa_open_data_docs.jsonl"

  - id: "uk_open_government_licence_sources_env"
    tier: "green"
    worker: "web_pdf_html_worker"
    discovery:
      seed_urls:
        # Use OGL-labeled portals and agencies with strong environmental holdings.
        - "https://www.gov.uk/government/organisations/environment-agency"
        - "https://environment.data.gov.uk/"
      allow_domains: ["gov.uk", "environment.data.gov.uk"]
      include_url_regex:
        - "(?i)open[-_ ]government[-_ ]licen[cs]e"
        - "(?i)\.pdf$"
      exclude_url_regex:
        - "(?i)/cookies"
        - "(?i)/privacy"
    licensing:
      expected: "OGL-UK-3.0"
      notes: "Keep attribution statements; store required attribution text in metadata."
    topic_tags: ["uk_env", "water", "flood", "air", "land"]
    outputs:
      jsonl: "text/uk_ogl_env.jsonl"

  - id: "canada_open_government_licence_sources_env"
    tier: "green"
    worker: "web_pdf_html_worker"
    discovery:
      seed_urls:
        - "https://open.canada.ca/en/open-data"
      allow_domains: ["open.canada.ca"]
      include_url_regex:
        - "(?i)open[-_ ]government[-_ ]licen[cs]e"
        - "(?i)climate"
        - "(?i)environment"
    licensing:
      expected: "OGL-Canada-2.0"
      notes: "Require attribution; capture per-dataset metadata license where present."
    topic_tags: ["canada_env", "climate", "water", "land"]
    outputs:
      jsonl: "text/canada_ogl_env.jsonl"

  - id: "eu_dataeuropa_editorial_and_guides"
    tier: "green"
    worker: "web_html_worker"
    discovery:
      seed_urls:
        - "https://data.europa.eu/en"
        - "https://dataeuropa.gitlab.io/data-provider-manual/"
      allow_domains: ["data.europa.eu", "dataeuropa.gitlab.io"]
      include_url_regex:
        - "(?i)copyright"
        - "(?i)licen[cs]e"
        - "(?i)legal"
        - "(?i)academy"
    licensing:
      expected: "CC-BY-4.0"
      notes: "Editorial content is CC BY 4.0 unless otherwise noted; dataset entries may vary—do per-record gating."
    topic_tags: ["eu_open_data", "licensing", "metadata"]
    outputs:
      jsonl: "text/eu_dataeuropa_guides.jsonl"

  - id: "australia_datagovau_ccby4_science_env"
    tier: "green"
    worker: "web_html_worker"
    discovery:
      seed_urls:
        - "https://www.data.gov.au/"
      allow_domains: ["data.gov.au"]
      include_url_regex:
        - "(?i)license_id=cc-by-4\.0"
        - "(?i)environment"
        - "(?i)science"
    licensing:
      expected: "CC-BY-4.0"
    topic_tags: ["australia_env", "science", "indicators"]
    outputs:
      jsonl: "text/australia_datagovau_env.jsonl"

  # ---------------------------------------------------------------------------
  # YELLOW: open-ish but conditional/mixed; require strict per-record license + scrubbing
  # ---------------------------------------------------------------------------

  - id: "copernicus_sentinel_stac_metadata"
    tier: "yellow"
    worker: "stac_worker"
    discovery:
      seed_urls:
        # Provide your own STAC endpoints as configured; many providers mirror Sentinel STAC.
        - "https://dataspace.copernicus.eu/"
      allow_domains: ["dataspace.copernicus.eu", "copernicus.eu", "sentinels.copernicus.eu"]
    extraction:
      mode: "metadata_only"
      include_fields:
        - "collection"
        - "license"
        - "providers"
        - "summaries"
        - "links"
        - "assets"
    licensing:
      expected: "COPERNICUS-SENTINEL-LEGAL-NOTICE"
      notes: "Sentinel data legal notice allows reproduction/distribution/adaptation; portal content may have separate limits—store both."
    topic_tags: ["satellite", "copernicus", "sentinel", "stac"]
    outputs:
      jsonl: "structured/copernicus_sentinel_stac_cards.jsonl"

  - id: "copernicus_climate_data_store_docs"
    tier: "yellow"
    worker: "web_pdf_html_worker"
    discovery:
      seed_urls:
        - "https://cds.climate.copernicus.eu/"
        - "https://climate.copernicus.eu/"
      allow_domains: ["cds.climate.copernicus.eu", "climate.copernicus.eu", "ewds.climate.copernicus.eu"]
      include_url_regex:
        - "(?i)licen[cs]e"
        - "(?i)terms"
        - "(?i)dataset"
        - "(?i)\.pdf$"
    licensing:
      expected: "COPERNICUS-LICENCE-MIXED"
      notes: "CDS products and third-party datasets can carry different licenses; enforce per-dataset license capture."
    topic_tags: ["reanalysis", "climate", "era5", "cmip6"]
    outputs:
      jsonl: "text/copernicus_cds_docs.jsonl"

  - id: "ecmwf_open_products_ccby4"
    tier: "yellow"
    worker: "api_metadata_worker"
    discovery:
      seed_urls:
        - "https://www.ecmwf.int/"
        - "https://confluence.ecmwf.int/"
      allow_domains: ["ecmwf.int", "confluence.ecmwf.int"]
      include_url_regex:
        - "(?i)licen[cs]e"
        - "(?i)cc[-_ ]by"
        - "(?i)attribution"
    licensing:
      expected: "CC-BY-4.0"
      notes: "Capture required attribution statements; retain dataset-level citation fields."
    topic_tags: ["weather", "forecasting", "reanalysis"]
    outputs:
      jsonl: "text/ecmwf_licensing_and_docs.jsonl"

  - id: "gbif_occurrence_cc0_ccby_only"
    tier: "yellow"
    worker: "api_tabular_worker"
    discovery:
      seed_urls:
        - "https://www.gbif.org/"
      allow_domains: ["gbif.org"]
    extraction:
      mode: "metadata_plus_schema"
      # IMPORTANT: only include CC0 or CC BY records; exclude CC BY-NC.
      license_allowlist:
        - "CC0-1.0"
        - "CC-BY-4.0"
        - "CC-BY-3.0"
      privacy_and_sensitivity:
        drop_fields:
          - "recordedBy"
          - "identifiedBy"
          - "verbatimLocality"
        # Optional coarse graining for sensitive taxa/areas.
        coordinate_policy: "coarsen_to_0p1deg_if_sensitive"
    licensing:
      expected: "MIXED-CC"
      notes: "GBIF aggregates publisher licenses; enforce record-level license gating."
    topic_tags: ["biodiversity", "species_occurrence", "ecology"]
    outputs:
      jsonl: "structured/gbif_occurrence_cc0_ccby.jsonl"

  - id: "pangaea_dataset_cards"
    tier: "yellow"
    worker: "api_metadata_worker"
    discovery:
      seed_urls:
        - "https://www.pangaea.de/"
        - "https://wiki.pangaea.de/wiki/License"
      allow_domains: ["pangaea.de", "wiki.pangaea.de"]
    extraction:
      mode: "dataset_card"
      include_fields:
        - "title"
        - "abstract"
        - "methods"
        - "parameters"
        - "coverage"
        - "citation"
        - "license"
    licensing:
      expected: "MIXED-CC"
      notes: "Enforce per-record license capture; prefer CC BY / CC0; route unknown licenses to review."
    topic_tags: ["ocean", "paleoclimate", "geochemistry", "ecosystems"]
    outputs:
      jsonl: "text/pangaea_dataset_cards.jsonl"

  - id: "world_bank_open_data_env_indicators"
    tier: "yellow"
    worker: "api_tabular_worker"
    discovery:
      seed_urls:
        - "https://data.worldbank.org/"
        - "https://datacatalog.worldbank.org/"
      allow_domains: ["worldbank.org", "data.worldbank.org", "datacatalog.worldbank.org"]
    extraction:
      mode: "indicator_cards"
    licensing:
      expected: "CC-BY-4.0+TERMS"
      notes: "World Bank Open Data is CC BY 4.0 with additional terms; store attribution + change-notice requirements."
    topic_tags: ["environment_indicators", "development", "emissions", "water"]
    outputs:
      jsonl: "structured/worldbank_env_indicators.jsonl"

  - id: "fao_statistical_databases_env_ag"
    tier: "yellow"
    worker: "api_tabular_worker"
    discovery:
      seed_urls:
        - "https://www.fao.org/"
      allow_domains: ["fao.org"]
    extraction:
      mode: "dataset_cards_plus_schema"
    licensing:
      expected: "CC-BY-4.0+TERMS"
      notes: "FAO statistical databases are typically CC BY 4.0 unless specified otherwise; keep attribution and terms."
    topic_tags: ["agriculture", "land_use", "food_systems", "water", "forestry"]
    outputs:
      jsonl: "structured/fao_env_ag_stats.jsonl"

  - id: "openstreetmap_docs_only"
    tier: "yellow"
    worker: "web_html_worker"
    discovery:
      seed_urls:
        - "https://www.openstreetmap.org/copyright"
        - "https://osmfoundation.org/licence"
      allow_domains: ["openstreetmap.org", "osmfoundation.org", "opendatacommons.org"]
    extraction:
      mode: "docs_only"
    licensing:
      expected: "ODbL-1.0"
      notes: "Include licensing/docs only; do not ingest planet extracts into the general training corpus unless you are ready for ODbL share-alike obligations."
    topic_tags: ["geospatial", "licensing", "odbl"]
    outputs:
      jsonl: "text/osm_licensing_docs.jsonl"

  - id: "arxiv_earth_and_env_categories"
    tier: "yellow"
    worker: "api_metadata_worker"
    discovery:
      seed_urls:
        - "https://arxiv.org/"
      allow_domains: ["arxiv.org"]
    extraction:
      mode: "metadata_plus_abstract"
      categories:
        - "physics.geo-ph"
        - "physics.ao-ph"
        - "q-bio"
        - "stat.AP"
    licensing:
      expected: "MIXED"
      notes: "Only ingest papers with an explicit permissive license; otherwise store metadata only."
    topic_tags: ["earth_science", "atmosphere", "methodology"]
    outputs:
      jsonl: "text/arxiv_earth_env_metadata.jsonl"

  # ---------------------------------------------------------------------------
  # RED: incompatible with “ethically + legally cleared” training corpus
  # ---------------------------------------------------------------------------

  - id: "ipcc_assessment_reports_and_graphics"
    tier: "red"
    worker: "blocklist"
    discovery:
      seed_urls:
        - "https://www.ipcc.ch/"
        - "https://archive.ipcc.ch/"
    licensing:
      expected: "RESTRICTED"
      notes: "IPCC report text/graphics often have restrictions (non-commercial excerpts; no alterations of figures); do not ingest."
    topic_tags: ["climate_assessment"]

  - id: "paywalled_journal_fulltext_and_textbooks"
    tier: "red"
    worker: "blocklist"
    licensing:
      expected: "ALL-RIGHTS-RESERVED"
    topic_tags: ["copyrighted_fulltext"]

  - id: "proprietary_satellite_imagery_tiles"
    tier: "red"
    worker: "blocklist"
    licensing:
      expected: "PROPRIETARY"
    topic_tags: ["commercial_imagery"]

  - id: "cc_by_nc_or_nd_collections"
    tier: "red"
    worker: "blocklist"
    licensing:
      expected: "CC-BY-NC|CC-BY-ND"
    topic_tags: ["noncommercial_or_noderivatives"]
