# field_schemas.yaml
# v0.8 â€” Versioned field definitions for KG + literature navigation pipeline
#
# Each schema version is immutable once released. Create a new version for changes.
# Schemas focus on computed/identifier-only fields to avoid ingesting protected text.

schema_version: "0.9"
updated_utc: "2025-12-18"

schemas:

  openalex_minimal_graph_v1.0.0:
    description: "OpenAlex minimal scholarly graph (IDs + links, no titles/abstracts)"
    version: "1.0.0"
    created_utc: "2025-12-18"
    source: "openalex_snapshot"
    notes: |
      Derived from OpenAlex CC0 monthly snapshot. Includes identifiers and structural
      relationships only (works, authorships, venues, concepts, references). Drops
      long text fields to preserve a computed-only, license-clean graph surface.
    fields:
      id:
        description: "OpenAlex work ID"
        type: "string"
        required: true
        nullable: false
      doi:
        description: "DOI (normalized)"
        type: "string"
        required: false
        nullable: true
      ids:
        description: "Identifier bundle (e.g., PMID, PMCID, MAG)"
        type: "object"
        required: false
        nullable: true
      type:
        description: "Work type code"
        type: "string"
        required: false
        nullable: true
      publication_year:
        description: "Publication year"
        type: "integer"
        required: false
        nullable: true
      publication_date:
        description: "Publication date (ISO-8601)"
        type: "string"
        required: false
        nullable: true
      referenced_works:
        description: "List of OpenAlex IDs for referenced works"
        type: "array"
        items: { type: "string" }
        required: false
        nullable: true
      related_works:
        description: "Related work IDs"
        type: "array"
        items: { type: "string" }
        required: false
        nullable: true
      cited_by_count:
        description: "Cited-by count"
        type: "integer"
        required: false
        nullable: true
      authorships:
        description: "Authorship edges with author + institution IDs"
        type: "array"
        items:
          type: "object"
        required: false
        nullable: true
      host_venue:
        description: "Venue container (journal, proceedings)"
        type: "object"
        required: false
        nullable: true
      primary_location:
        description: "Primary hosting location"
        type: "object"
        required: false
        nullable: true
      locations_count:
        description: "Number of hosting locations"
        type: "integer"
        required: false
        nullable: true
      concepts:
        description: "Concept assignments with IDs + scores"
        type: "array"
        items: { type: "object" }
        required: false
        nullable: true
      institutions_distinct_count:
        description: "Distinct institutions in authorships"
        type: "integer"
        required: false
        nullable: true
      grants:
        description: "Grant metadata (IDs, funders)"
        type: "array"
        items: { type: "object" }
        required: false
        nullable: true
      open_access:
        description: "Open access metadata (status, license code)"
        type: "object"
        required: false
        nullable: true
      biblio:
        description: "Structured biblio fields (volume, issue, pages)"
        type: "object"
        required: false
        nullable: true
      is_retracted:
        description: "Retraction flag"
        type: "boolean"
        required: false
        nullable: true
    output_record:
      id_field: "id"
      mappings:
        work_id: "id"
        doi: "doi"
        type: "type"
        pub_year: "publication_year"
        cited_by: "cited_by_count"
        references: "referenced_works"

  crossref_minimal_graph_v1.0.0:
    description: "Crossref minimal DOI graph (identifier + link surface)"
    version: "1.0.0"
    created_utc: "2025-12-18"
    source: "crossref_public_data_file"
    notes: |
      Extract only structured identifiers, dates, and relationship metadata from the
      Crossref public data file. Avoid abstracts, full reference strings, and author
      details to keep the output computed-only.
    fields:
      DOI:
        description: "Digital Object Identifier"
        type: "string"
        required: true
        nullable: false
      created:
        description: "Record creation timestamp"
        type: "object"
        required: false
        nullable: true
      published:
        description: "Published timestamp"
        type: "object"
        required: false
        nullable: true
      issued:
        description: "Issued timestamp"
        type: "object"
        required: false
        nullable: true
      type:
        description: "Crossref work type"
        type: "string"
        required: false
        nullable: true
      container-title:
        description: "Short container titles"
        type: "array"
        items: { type: "string" }
        required: false
        nullable: true
      publisher:
        description: "Publisher name"
        type: "string"
        required: false
        nullable: true
      member:
        description: "Crossref member ID"
        type: "string"
        required: false
        nullable: true
      prefix:
        description: "DOI prefix"
        type: "string"
        required: false
        nullable: true
      references_count:
        description: "Count of references"
        type: "integer"
        required: false
        nullable: true
      is-referenced-by-count:
        description: "Cited-by count"
        type: "integer"
        required: false
        nullable: true
      relation:
        description: "Typed DOI relations"
        type: "object"
        required: false
        nullable: true
      subject:
        description: "Subject terms"
        type: "array"
        items: { type: "string" }
        required: false
        nullable: true
      ISBN:
        description: "ISBN identifiers"
        type: "array"
        items: { type: "string" }
        required: false
        nullable: true
      ISSN:
        description: "ISSN identifiers"
        type: "array"
        items: { type: "string" }
        required: false
        nullable: true
      assertion:
        description: "Structured assertions (e.g., funder IDs)"
        type: "array"
        items: { type: "object" }
        required: false
        nullable: true
    output_record:
      id_field: "DOI"
      mappings:
        doi: "DOI"
        type: "type"
        published: "published"
        issued: "issued"
        references_count: "references_count"

  datacite_minimal_graph_v1.0.0:
    description: "DataCite PID Graph (identifiers + relations only)"
    version: "1.0.0"
    created_utc: "2025-12-18"
    source: "datacite_public_data_file"
    notes: |
      Captures PIDGraph-friendly identifiers and relations (DOI, ORCID, ROR, related
      identifiers) without ingesting abstracts or long descriptions. Intended for
      provenance-safe navigation tasks.
    fields:
      id:
        description: "DataCite internal ID"
        type: "string"
        required: false
        nullable: true
      doi:
        description: "Record DOI"
        type: "string"
        required: true
        nullable: false
      types:
        description: "Resource type bundle"
        type: "object"
        required: false
        nullable: true
      publicationYear:
        description: "Publication year"
        type: "integer"
        required: false
        nullable: true
      dates:
        description: "Date records (accepted, updated)"
        type: "array"
        items: { type: "object" }
        required: false
        nullable: true
      relatedIdentifiers:
        description: "Typed related identifiers (links to other DOIs/ORCIDs/RORs)"
        type: "array"
        items: { type: "object" }
        required: false
        nullable: true
      fundingReferences:
        description: "Funding references with funder IDs"
        type: "array"
        items: { type: "object" }
        required: false
        nullable: true
      subjects:
        description: "Subject terms"
        type: "array"
        items: { type: "string" }
        required: false
        nullable: true
      rightsList:
        description: "Rights statements (license codes)"
        type: "array"
        items: { type: "object" }
        required: false
        nullable: true
      identifiers:
        description: "Alternate identifiers"
        type: "array"
        items: { type: "object" }
        required: false
        nullable: true
    output_record:
      id_field: "doi"
      mappings:
        doi: "doi"
        publication_year: "publicationYear"
        related: "relatedIdentifiers"

  nav_episode_v1.0.0:
    description: "Grounded navigation episode schema (prompt/answer/evidence/metadata)"
    version: "1.0.0"
    created_utc: "2025-12-18"
    source: "kg_navigation_episodes"
    notes: |
      Supervises retrieval + grounding behavior. Evidence must be identifier-based
      with provenance to underlying graph slices.
    fields:
      prompt:
        description: "User query / task"
        type: "string"
        required: true
        nullable: false
      answer:
        description: "Concise grounded answer"
        type: "string"
        required: true
        nullable: false
      evidence:
        description: "List of evidence objects with IDs and edge proofs"
        type: "array"
        items: { type: "object" }
        required: true
        nullable: false
      metadata:
        description: "Task metadata (type, hop_count, dataset provenance)"
        type: "object"
        required: true
        nullable: false
    output_record:
      id_field: null
      mappings:
        prompt: "prompt"
        answer: "answer"
        evidence: "evidence"
        metadata: "metadata"

  kg_navigation_episode_v2.0.0:
    description: "Navigation episodes synthesized from combined KG records with structural metadata for sorter routing"
    version: "2.0.0"
    created_utc: "2026-06-15"
    source: "sorter_pipeline episode synthesis"
    notes: |
      Captures prompt/answer pairs plus machine-readable metadata used for sorter
      routing. Avoids PII by focusing on identifiers, citations, and graph edges.
    fields:
      record_id:
        description: "Stable episode identifier"
        type: "string"
        required: true
        nullable: false
      text:
        description: "Rendered prompt + answer text for training"
        type: "string"
        required: true
        nullable: false
      episode:
        description: "Structured episode payload (prompt, answer, evidence, tools)"
        type: "object"
        required: false
        nullable: true
      metadata:
        description: "Navigation metadata used for sorter routing"
        type: "object"
        required: false
        nullable: true
      routing:
        description: "Routing tuple used for foldering (subject/domain/category)"
        type: "object"
        required: false
        nullable: true
      hash:
        description: "Content hashes for dedupe"
        type: "object"
        required: false
        nullable: true
    output_record:
      id_field: "record_id"
      mappings:
        episode_id: "record_id"
        task_type: "metadata.task_type"
        hop_count: "metadata.hop_count"
