# license_map.yaml
# v0.3 â€” companion file for math targets (schema v0.8) and pipeline scripts
#
# This is NOT legal advice. It is a conservative, automation-friendly policy layer tailored for the math corpus pipeline:
# - "allow" = generally permissive / OK for model training
# - "conditional" = often OK but requires careful handling (attribution, share-alike segregation)
# - "deny_prefixes" = hard reject (NonCommercial, NoDerivatives, proprietary, NoAI/TDM statements)
#
# The pipeline stores evidence snapshots so you can audit every decision.

schema_version: "0.3"
updated_utc: "2025-03-01"

spdx:
  # GREEN: typically OK for training
  allow:
    - "CC0-1.0"
    - "CC-BY-4.0"
    - "CC-BY-3.0"
    - "MIT"
    - "Apache-2.0"
    - "BSD-2-Clause"
    - "BSD-3-Clause"
    - "ISC"
    - "Unlicense"
    - "US-PUBLIC-DOMAIN"
    - "PDDL-1.0"

  # YELLOW by default: allowed only with constraints (e.g., attribution bundles, share-alike segregation)
  conditional:
    - "CC-BY-SA-4.0"
    - "CC-BY-SA-3.0"
    - "GPL-3.0-only"
    - "GPL-3.0-or-later"
    - "GPL-2.0-only"
    - "GPL-2.0-or-later"
    - "LGPL-3.0-only"
    - "LGPL-3.0-or-later"
    - "LGPL-2.1-only"
    - "LGPL-2.1-or-later"
    - "FDL-1.3"          # GNU Free Documentation License (common on wikis)

  # Hard RED by default: explicitly incompatible with training or redistribution
  deny_prefixes:
    - "CC-BY-NC"         # NonCommercial variants
    - "CC-BY-ND"         # NoDerivatives variants
    - "CC-BY-NC-SA"
    - "CC-BY-NC-ND"
    - "CC-BY-NC-4.0"
    - "Proprietary"
    - "Custom-Restrictive"
    - "All-Rights-Reserved"
    - "NOAI"
    - "NOAI-"
    - "NO-TDM"
    - "NON-COMMERCIAL"
    - "NO-DERIVATIVES"

normalization:
  # Rules are simple substring matches over the evidence blob (fetched page text + hint + name).
  # Order matters: first match wins.
  rules:
    # Public Domain
    - match_any: ["CC0", "Creative Commons Zero", "Public Domain Dedication", "CC0 1.0"]
      spdx: "CC0-1.0"
    - match_any: ["PDDL", "Public Domain Dedication and License", "Open Data Commons Public Domain"]
      spdx: "PDDL-1.0"
    - match_any: ["U.S. Government work", "United States Government work", "public domain", "US public domain", "Public Domain"]
      spdx: "US-PUBLIC-DOMAIN"

    # Creative Commons Attribution
    - match_any: ["CC-BY 4.0", "CC BY 4.0", "Creative Commons Attribution 4.0", "CC-BY-4.0", "Creative Commons Attribution", "Open Access (CC BY)"]
      spdx: "CC-BY-4.0"
    - match_any: ["CC-BY 3.0", "CC BY 3.0", "Creative Commons Attribution 3.0", "CC-BY-3.0"]
      spdx: "CC-BY-3.0"

    # Creative Commons ShareAlike
    - match_any: ["CC-BY-SA 4.0", "CC BY-SA 4.0", "Creative Commons Attribution-ShareAlike 4.0", "CC-BY-SA-4.0", "ShareAlike"]
      spdx: "CC-BY-SA-4.0"
    - match_any: ["CC-BY-SA 3.0", "CC BY-SA 3.0", "Creative Commons Attribution-ShareAlike 3.0", "CC-BY-SA-3.0"]
      spdx: "CC-BY-SA-3.0"

    # Open source licenses
    - match_any: ["Apache License 2.0", "Apache-2.0", "Apache 2.0"]
      spdx: "Apache-2.0"
    - match_any: ["MIT License", "MIT"]
      spdx: "MIT"
    - match_any: ["BSD 3-Clause", "BSD-3-Clause", "3-Clause BSD", "BSD-style"]
      spdx: "BSD-3-Clause"
    - match_any: ["BSD 2-Clause", "BSD-2-Clause", "2-Clause BSD", "Simplified BSD"]
      spdx: "BSD-2-Clause"
    - match_any: ["ISC License", "ISC"]
      spdx: "ISC"

    # GPL/FDL family
    - match_any: ["GNU General Public License v3", "GPL-3.0", "GPLv3", "Copyleft"]
      spdx: "GPL-3.0-or-later"
    - match_any: ["GNU General Public License v2", "GPL-2.0", "GPLv2"]
      spdx: "GPL-2.0-or-later"
    - match_any: ["GNU Lesser General Public License", "LGPL"]
      spdx: "LGPL-3.0-or-later"
    - match_any: ["GNU Free Documentation License", "FDL", "GFDL"]
      spdx: "FDL-1.3"

    # Restrictive licenses (detect and mark)
    - match_any: ["noncommercial", "non-commercial", "NC license", "for non-commercial"]
      spdx: "CC-BY-NC-4.0"
    - match_any: ["no derivatives", "no-derivatives", "ND license", "No derivatives"]
      spdx: "CC-BY-ND-4.0"
    - match_any: ["all rights reserved", "All rights reserved"]
      spdx: "All-Rights-Reserved"
    - match_any: ["NoAI", "No AI", "No training"]
      spdx: "NOAI"
    - match_any: ["No text and data mining", "no text and data mining"]
      spdx: "NO-TDM"

    # Generic fallbacks (should come last)
    - match_any: ["terms of use", "terms and conditions", "custom license", "proprietary"]
      spdx: "Custom-Restrictive"

restriction_scan:
  # Restriction phrase scanning is intentionally conservative.
  # Any hit pushes effective_bucket to gating.restriction_phrase_bucket (default YELLOW).
  # Add phrases you want to treat as "needs manual review".
  phrases:
    # AI/ML specific
    - "no ai"
    - "no artificial intelligence"
    - "no machine learning"
    - "no ml"
    - "no llm"
    - "no large language model"
    - "no generative ai"
    - "no generative artificial intelligence"
    - "may not be used to train"
    - "no model training"
    - "no training of models"
    - "prohibited from training"
    - "not for training"

    # Text and data mining
    - "no text and data mining"
    - "no tdm"
    - "no text mining"
    - "no data mining"

    # Commercial restrictions
    - "no commercial use"
    - "non-commercial use only"
    - "commercial use prohibited"
    - "for academic use only"
    - "for research use only"
    - "educational use only"

    # General restrictions
    - "prohibited use"
    - "not permitted for"
    - "restricted use"
    - "usage restrictions apply"

    # Additional phrases
    - "opt out of ai training"
    - "excluded from ai training"
    - "robots.txt noai"
    - "noai meta tag"

gating:
  # SPDX -> bucket mapping behavior
  conditional_spdx_bucket: "YELLOW"
  unknown_spdx_bucket: "YELLOW"
  deny_spdx_bucket: "RED"

  # Restriction phrase hits override to this bucket
  restriction_phrase_bucket: "YELLOW"

profiles:
  permissive:
    default_bucket: "GREEN"
  copyleft:
    default_bucket: "YELLOW"
  record_level:
    default_bucket: "YELLOW"
  unknown:
    default_bucket: "YELLOW"
  deny:
    default_bucket: "RED"
