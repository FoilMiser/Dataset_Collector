# field_schemas.yaml
# v0.2 â€” Regulation & Compliance metadata contracts (v2 pipeline)
#
# Captures provenance, versioning, hierarchy, rights, and policy flags for
# legal/regulatory corpora while adding the v2-required routing + hash fields.

schema_version: "0.2"
updated_utc: "2025-12-24"

schemas:
  regcomp_doc_v0.2.0:
    description: "Core regulation/compliance document metadata (v2)"
    version: "0.2.0"
    created_utc: "2025-12-24"
    source: "regulation_and_compliance_corpus"
    notes: |
      Contract for primary documents (statutes, regulations, guidance, enforcement,
      case law, audits). Aligns with the v2 pipeline layout and preserves
      jurisdiction/authority hierarchy along with routing + hash metadata.

    fields:
      record_id:
        description: "Stable record identifier for v2 outputs"
        type: "string"
        required: true
        nullable: false
        validation:
          max_length: 256

      hash:
        description: "Hash bundle"
        type: "object"
        required: true
        nullable: false

      routing:
        description: "Routing metadata used for sorter topic routing"
        type: "object"
        required: true
        nullable: false

      source:
        description: "Source provenance metadata"
        type: "object"
        required: true
        nullable: false

      text:
        description: "Canonical extracted text"
        type: "string"
        required: true
        nullable: false

      doc_id:
        description: "Stable hash or canonical identifier"
        type: "string"
        required: false
        nullable: true
        validation:
          max_length: 256

      source_id:
        description: "Pipeline target identifier (e.g., govinfo_cfr_bulk)"
        type: "string"
        required: true
        nullable: false

      retrieved_at:
        description: "Timestamp of retrieval"
        type: "datetime"
        required: true
        nullable: false

      canonical_url:
        description: "Canonical URL of the document"
        type: "string"
        required: false
        nullable: true
        validation:
          pattern: "^https?://.+$"

      jurisdiction:
        description: "Jurisdiction code (US-FED / EU / UK / CA / AU / US-STATE-XX)"
        type: "string"
        required: true
        nullable: false

      authority:
        description: "Issuing authority (agency/court/parliament/etc.)"
        type: "string"
        required: true
        nullable: false

      doc_type:
        description: "Document type (statute, regulation, guidance, enforcement, case_law, audit, docket, comment)"
        type: "string"
        required: true
        nullable: false

      published_date:
        description: "Publication date"
        type: "date"
        required: false
        nullable: true

      effective_date:
        description: "Effective date"
        type: "date"
        required: false
        nullable: true

      last_modified_date:
        description: "Last modified or amendment date"
        type: "date"
        required: false
        nullable: true

      supersedes:
        description: "Identifier(s) of prior versions"
        type: "array"
        required: false
        nullable: true

      superseded_by:
        description: "Identifier(s) of later versions"
        type: "array"
        required: false
        nullable: true

      is_consolidated_version:
        description: "Whether this is a consolidated version"
        type: "boolean"
        required: false
        nullable: true

      snapshot_date:
        description: "Snapshot date for dynamic sources (e.g., eCFR)"
        type: "date"
        required: false
        nullable: true

      citations:
        description: "List of normalized citations (USC, CFR, CELEX, docket IDs)"
        type: "array"
        required: false
        nullable: true

      section_path:
        description: "Structured section hierarchy path"
        type: "array"
        required: false
        nullable: true

      heading_path:
        description: "Structured heading hierarchy path"
        type: "array"
        required: false
        nullable: true

      license_detected:
        description: "Detected license or terms label"
        type: "string"
        required: false
        nullable: true

      license_confidence:
        description: "Confidence score for license detection"
        type: "float"
        required: false
        nullable: true
        validation:
          min: 0.0
          max: 1.0

      attribution_required:
        description: "Whether attribution is required"
        type: "boolean"
        required: false
        nullable: true

      attribution_text:
        description: "Attribution text bundle"
        type: "string"
        required: false
        nullable: true

      third_party_flags:
        description: "Flags for embedded third-party content"
        type: "object"
        required: false
        nullable: true

      pii_flags:
        description: "Flags for detected PII categories"
        type: "object"
        required: false
        nullable: true

      policy_decision:
        description: "Pipeline decision (keep / drop / keep_redacted / quarantine_for_review)"
        type: "string"
        required: false
        nullable: true

      chunk_id:
        description: "Stable chunk identifier (doc_id + section_path + chunk index)"
        type: "string"
        required: false
        nullable: true

      chunk_heading_path:
        description: "Heading path for the chunk"
        type: "array"
        required: false
        nullable: true

      chunk_citations:
        description: "Citations relevant to the chunk"
        type: "array"
        required: false
        nullable: true

      chunk_is_definitions:
        description: "Whether the chunk is part of a definitions section"
        type: "boolean"
        required: false
        nullable: true

    output_record:
      id_field: "record_id"
      mappings:
        record_id: "record_id"
        hash: "hash"
        routing: "routing"
        source: "source"
        text: "text"
        doc_id: "doc_id"
        source_id: "source_id"
        jurisdiction: "jurisdiction"
        authority: "authority"
        doc_type: "doc_type"
        published_date: "published_date"
        effective_date: "effective_date"
        last_modified_date: "last_modified_date"
        supersedes: "supersedes"
        superseded_by: "superseded_by"
        is_consolidated_version: "is_consolidated_version"
        snapshot_date: "snapshot_date"
        citations: "citations"
        section_path: "section_path"
        heading_path: "heading_path"
        license_detected: "license_detected"
        license_confidence: "license_confidence"
        attribution_required: "attribution_required"
        attribution_text: "attribution_text"
        third_party_flags: "third_party_flags"
        pii_flags: "pii_flags"
        policy_decision: "policy_decision"
        chunk_id: "chunk_id"
        chunk_heading_path: "chunk_heading_path"
        chunk_citations: "chunk_citations"
        chunk_is_definitions: "chunk_is_definitions"
